using System;
using System.Collections.Generic;
using System.Linq;
using System.Reflection;
using System.Text;
using System.Threading.Tasks;

namespace HoldToCommand.ValheimAPI.LowLevel.Core.Invokers
{ 
    public class ConstFieldInvoker<R>
    {
        protected readonly FieldInfo member;
        protected readonly Func<object, R> _getter;

        public ConstFieldInvoker(Type type, string name)
        {
            var bindingAttr =
                BindingFlags.Static |
                BindingFlags.Instance |
                BindingFlags.Public |
                BindingFlags.NonPublic |
                BindingFlags.DeclaredOnly;

            member = type.GetField(name, bindingAttr);
            if (member == null)
                throw new MissingFieldException(type.FullName, name);

            if (!member.IsLiteral)
            {
                // throw error
            }

            object value = member.GetRawConstantValue();
            R casted = (R)value;
            _getter = _ => casted;
        }

        public R Get(object instance) => _getter(instance);


    }
}
